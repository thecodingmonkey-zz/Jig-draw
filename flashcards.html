<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="css/style.css" rel="stylesheet" media="screen">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

  <title>Jig-draw flashcards</title>
  <script src="words.js"></script>
  <script language="javascript">
  window.onload = function() {
    window.setTimeout(function() {window.update();}, 1000);
    window.secSinceLastClue = 0;
    window.playerScore0 = 0;
    window.playerScore1 = 0;

    window.update = function() {
      var timer = document.getElementById('timer').innerHTML;
      timer = Math.max(0, parseInt(timer) - 1);
      document.getElementById('timer').innerHTML = timer;

      if (timer <= 0) {
        window.playsound('woopow');
        document.getElementById('timer').innerHTML = 60;
//        alert('Time is up!');
        window.getNewWord();
//        window.bgaudio.stop();
        window.bgaudio.pause();
        window.bgaudio.currentTime = 0;
        window.setTimeout(window.update, 10000);
        return;
      }
      else if (timer % 5 === 0 && timer < 60) {
        window.playsound('ding');
      }

      if (timer < 10) {
        document.getElementById('timer').style.color = 'red';
      } else {
        document.getElementById('timer').style.color = 'black';      
      }

      if (timer == 60) {
        window.playsound('bgmusic');
      }

      secSinceLastClue++;
      if (secSinceLastClue >= 10) {
        this.cycleClues();
        secSinceLastClue = 0;
      }

      window.setTimeout(window.update, 1000);
    };

    var currentWord;

    window.getNewWord = function() {
      var numWords = window.library.words.length;
      var newWord = Math.floor(Math.random() * numWords);
      currentWord = newWord;

      document.getElementById('majorWord').innerHTML = library.words[newWord][0];
      document.getElementById('minorWord').innerHTML = library.words[newWord][1];

      document.getElementById('timer').innerHTML = '61';

      secSinceLastClue = 0;
    };

    window.getNewWord();


    window.cycleClues = function() {
      var currentMajorWord = document.getElementById('majorWord').innerHTML;
      var currentMinorWord = document.getElementById('minorWord').innerHTML;

      var i;  // find where the given word is in the dictionary of word-clues
      for(i=0; i < window.library.words.length; i++) {
        if (window.library.words[i][0] == currentMajorWord)
          break;
      }

      var currentWord = i;
//      var currentWord = window.library.words.indexOf(currentMajorWord);
//      console.log(currentMajorWord, currentWord);
      var currentClue = window.library.words[currentWord].indexOf(currentMinorWord);

      currentClue++;
      if (currentClue >= window.library.words[currentWord].length) {
        currentClue = 1;
      }

      document.getElementById('minorWord').innerHTML = window.library.words[currentWord][currentClue];

      secSinceLastClue = 0;
    }
    window.incrementPlayerScore = function(player) {
      if (player == 0) {
        window.playerScore0++;
        document.getElementById('player0Score').innerHTML = window.playerScore0;
      }
      else {
        window.playerScore1++;
        document.getElementById('player1Score').innerHTML = window.playerScore1;
      }
      window.getNewWord();
    }

    document.onkeydown = function(e) {
      e = e || window.event;
      switch(e.which || e.keyCode) {
//        case 32:
        case 32:
          window.playsound('ding');
          break;
        case 38:
        case 40:
          alert('pause');
          break;
        case 37:  // left
          window.incrementPlayerScore(0);
          window.playsound('likeabaws');
          break;
        case 39:  // right
          window.incrementPlayerScore(1);
          window.playsound('likeabaws');
          break;
      }
    }

    window.playsound = function(sound) {
      var audio;
      if (sound == 'ding') {
        audio = new Audio('./sounds/ding.wav');
        audio.play();
      }
      if (sound == 'woopow') {
        audio = new Audio('./sounds/woopow.wav');
        audio.play();
      }
      if (sound == 'bgmusic') {
        if (window.bgaudio) {
          window.bgaudio.pause();
          window.bgaudio.currentTime = 0;
        }
        window.bgaudio = new Audio('./sounds/60secRoundMus.wav');
        window.bgaudio.play();
      }
      if (sound == 'likeabaws') {
        audio = new Audio('./sounds/likeabaws.wav');
        audio.play();

      }
    }
  }
  </script>
</head>
<body>
  <script type="text/javascript">
  function getNewWord() {
    window.getNewWord();

  }
  </script>

  <header>
    <div id="status" class="group">
      <span>:</span><span id="timer">61</span>
      </div><!--Status div -->
      <nav class="group">
         <!-- <ul>
          <li class="button" onclick="javascript:window.getNewWord();">New Word</li>
          <li class="button" onclick="javascript:window.getNewWord();">New Word</li>
          <li class="button" onclick="javascript:window.cycleClues();">New Clue</li>
        </ul> -->
        <span class="button left" onclick="javascript:window.incrementPlayerScore(0);">Player 1</span>
        <span id="player0Score" class="left">0</span>
        <span class="button right" onclick="javascript:window.incrementPlayerScore(1);">Player 2</span>
        <span id="player1Score" class="right">0</span>
      </nav>
    </header>
    <div class="container">
      <div id="majorWord">Foo</div>
      <div id="minorWord">Bar</div>
    </div>
  <span class="button" onclick="javascript:window.cycleClues();">New Clue</span>
  </div>
</body>
</html>
